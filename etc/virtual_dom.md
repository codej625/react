# React Virtual DOM

<br />
<br />

* DOM(Document Object Model)

---

```
Virtual DOM을 알아보기 전에 DOM을 알아보자.

DOM은 웹 애플리케이션에서 DOM은 HTML 요소의 계층 구조(tree 형태로 표현)로,
이는 브라우저가 화면에 그리는 웹 페이지의 구조를 정의한다.

DOM은 JavaScript를 통해 동적으로 변경할 수 있다.
하지만 DOM 조작은 비용이 많이 들고,
특히 대규모 애플리케이션에서는 성능 문제를 초래할 수 있다.
```

<br />
<br />
<br />
<br />

1. Virtual DOM

```
Virtual DOM은 실제 DOM과 같은 내용을 담고 있는 가볍고 빠른 복사본이다.
이는 메모리에 저장된 "JavaScript 객체" 형태로,
브라우저에 직접적으로 접근하지 않기 때문에 접근 및 수정이 빠르다.
```

<br />
<br />
<br />

2. 리액트의 Virtual DOM 작동 과정 - 최초 렌더링 (Initial Render)

<br />

`1) 트리거 (Trigger)`

```
* 애플리케이션이 처음 로드될 때 ReactDOM.createRoot(rootElement).render(<App />)와 같이,
  최상위 컴포넌트를 렌더링하라는 명령이 실행된다.
```

<br />

`2) 렌더링 (Render Phase)`

```
* React는 최상위 컴포넌트(App)부터 시작하여 모든 자식 컴포넌트 함수를 재귀적으로 호출한다.

* 각 컴포넌트는 props와 state를 바탕으로 UI가 어떻게 생겨야 하는지에 대한 설명,
  즉 React 엘리먼트(Element) 트리를 반환한다.
  이것은 일반 JavaScript 객체일 뿐이며, 실제 UI가 아니다.
```

<br />

`3) 커밋 (Commit Phase)`

```
* Virtual DOM 생성 -> React는 렌더링 단계에서 생성된 엘리먼트 트리를 바탕으로 UI의 구조를 나타내는 Virtual DOM을 메모리에 생성한다.
  이것이 UI의 첫번째 "설계도" 또는 "스냅샷"이다.

* 실제 DOM 생성 -> React는 이 Virtual DOM을 보고,
  실제 브라우저에 해당하는 HTML DOM 노드들을 처음부터 끝까지 전부 생성하여 화면에 표시한다.
  이 과정은 애플리케이션 시작 시 단 한 번만 발생한다.
```

<br />
<br />
<br />

3. 리액트의 Virtual DOM 작동 과정 - 업데이트 발생 (Update Trigger) - "새로운 요구사항 접수"

```
최초 렌더링 이후,
다음과 같은 이벤트가 발생하면 업데이트 프로세스가 시작된다.
```

<br />
<br />

`1) state 변경`

```

* useState의 세터 함수(예: setCount(1))가 호출될 때

```

<br />

`2) props 변경`

```

* 부모 컴포넌트로부터 받은 props가 변경될 때.

```

<br />

`3) 상태 관리 라이브러리`

```

* 컴포넌트가 구독하는 Redux, Zustand, Recoil 등의 스토어 데이터가 변경될 때.

```

<br />

`4) 강제 업데이트` 

```

* forceUpdate() 메서드가 호출될 때 (거의 사용하지 않음).

```

<br />
<br />
<br />


4. 리액트의 Virtual DOM 작동 과정 - 리렌더링 및 비교 (Re-render & Diffing) - "두 설계도 비교"

<br />

`1) 리렌더링 (Re-render)`

```
* 업데이트가 발생한 컴포넌트와 그 모든 자식 컴포넌트들의 함수가 전부 재실행된다.

* 이 과정을 통해 새로운 props와 state를 기반으로 한 새로운 React 엘리먼트 트리가 생성된다.
```

<br />

`2) 비교 (Diffing)`

```
* 이제 React는 두 개의 Virtual DOM을 비교하게 된다.

  이전 스냅샷 -> 메모리에 이미 저장되어 있던, 변경 전의 Virtual DOM.
  새로운 결과물 -> 방금 리렌더링을 통해 생성된 새로운 Virtual DOM.
```

```
* React는 매우 효율적인 "Diffing 알고리즘"을 사용하여, 두 트리의 차이점을 찾아낸다.

  다른 타입의 엘리먼트 -> <div>가 <p>로 바뀌면, React는 이전 트리를 완전히 버리고 새로운 트리를 처음부터 새로 구축.
  같은 타입의 엘리먼트 -> <div>가 그대로 <div>라면, React는 속성(className, style 등)만 비교하여 변경된 속성만 업데이트 목록에 추가.
  자식 엘리먼트 리스트 -> 배열을 렌더링할 때, React는 각 항목의 key 속성을 사용하여 어떤 항목이 추가, 삭제, 또는 재정렬되었는지 효율적으로
                     파악한다. (key가 중요한 이유가 바로 이것)
```

<br />
<br />
<br />

5. 리액트의 Virtual DOM 작동 과정 - 재조정 및 실제 DOM 업데이트 (Reconciliation & Commit) - "최소한의 변경으로 리모델링"

<br />

`1) 변경사항 수집` 

```

* Diffing 단계에서 찾아낸 모든 차이점들을 하나의 목록으로 모은다.

```

<br />

`2) 커밋 (Commit Phase)`

```
* React는 이 변경사항 목록을 실제 브라우저 DOM에 한 번에 일괄적으로 적용한다.

* 예를 들어, 클래스 이름 변경, 텍스트 내용 수정, 자식 노드 추가 등 필요한 작업만 "외과수술처럼" 정밀하게 수행한다.
  이것이 바로 "부분적인 업데이트"이다.
```

<br />

`3) 스냅샷 교체` 

```
* 실제 DOM 업데이트가 완료되면,
  비교에 사용되었던 새로운 Virtual DOM이 이제 메모리의 "최신 스냅샷"으로 저장되어 다음 업데이트를 대비한다.
```

<br />
<br />
<br />

6. 핵심 요약

<br />

`컴포넌트 재실행 ≠ DOM 업데이트` 

```
* state가 바뀌면 컴포넌트 함수는 다시 실행되지만,
  이것이 곧바로 화면 전체를 새로 그리는 것을 의미하지는 않는다.
```

<br />

`Virtual DOM은 설계도`

```
* React는 메모리상에서 가상의 "설계도"를 먼저 그려보고,
  이전 설계도와 비교하여 변경사항을 계산한다.
```

<br />

`DOM 조작은 비싸다`

```
* 실제 브라우저의 DOM을 변경하는 것은 비용이 큰 작업이기 때문에,
  React의 모든 전략은 이 비싼 작업을 최소화하는 데 맞춰져 있다.
```

<br />

`key는 길잡이` 

```
* 리스트 렌더링 시 key는 React가 어떤 항목이 변경되었는지,
  빠르고 정확하게 알 수 있도록 돕는 필수적인 길잡이이다.
```
